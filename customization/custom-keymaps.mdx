---
title: Custom Keymaps
description: Learn how to add and customize keyboard shortcuts in nvim-luffy
---

## Overview

nvim-luffy uses Neovim's built-in keymap API to define keyboard shortcuts. This guide shows you how to add custom keymaps and understand the existing keymap structure.

## Understanding the Keymap Structure

All core keymaps are defined in `lua/leyland/core/keymaps.lua`. The file uses a concise pattern:

```lua
vim.g.mapleader = " " -- Set leader key to space
local keymap = vim.keymap -- Shorthand for convenience

-- Example keymap
keymap.set("n", "<leader>|", "<C-w>v", { desc = "Split window vertically" })
```

## Basic Keymap Syntax

The `vim.keymap.set()` function takes these parameters:

```lua
vim.keymap.set(mode, lhs, rhs, opts)
```

- **mode**: The mode(s) where the keymap applies ("n", "i", "v", "x", "t", "c", "o")
- **lhs**: The key combination to trigger (left-hand side)
- **rhs**: The action to perform (right-hand side)
- **opts**: Optional table with settings (desc, silent, noremap, etc.)

### Mode Reference

| Mode | Description | Example Use |
|------|-------------|-------------|
| `"n"` | Normal mode | General navigation and commands |
| `"i"` | Insert mode | While typing text |
| `"v"` | Visual and Select mode | When text is selected |
| `"x"` | Visual mode only | Visual selections |
| `"s"` | Select mode | Select mode operations |
| `"o"` | Operator-pending | After operators like `d`, `c`, `y` |
| `"t"` | Terminal mode | In `:terminal` buffers |
| `"c"` | Command-line mode | In the command line |

<Tip>
You can specify multiple modes by passing a table: `{"n", "v"}` applies the keymap to both normal and visual modes.
</Tip>

## Adding Custom Keymaps

### Method 1: Edit keymaps.lua (Recommended)

Add your custom keymaps to `lua/leyland/core/keymaps.lua:16`:

<Steps>
  <Step title="Open the keymaps file">
    Open `lua/leyland/core/keymaps.lua` in Neovim.
  </Step>

  <Step title="Add your keymaps">
    Add your custom keymaps at the end of the file:

    ```lua
    -- Your custom keymaps
    keymap.set("n", "<leader>w", "<cmd>w<CR>", { desc = "Save file" })
    keymap.set("n", "<leader>q", "<cmd>q<CR>", { desc = "Quit" })
    keymap.set("n", "<C-d>", "<C-d>zz", { desc = "Scroll down and center" })
    keymap.set("n", "<C-u>", "<C-u>zz", { desc = "Scroll up and center" })
    ```
  </Step>

  <Step title="Save and test">
    Save the file and source it with `:source %` or restart Neovim. Test your new keymaps.
  </Step>
</Steps>

### Method 2: Create a Custom Keymaps File

For better organization, create a separate file for your personal keymaps:

<Steps>
  <Step title="Create custom keymaps file">
    Create `lua/leyland/core/custom-keymaps.lua`:

    ```lua
    local keymap = vim.keymap

    -- Personal keymaps
    keymap.set("n", "<leader>w", "<cmd>w<CR>", { desc = "Save file" })
    keymap.set("n", "<leader>q", "<cmd>q<CR>", { desc = "Quit" })
    ```
  </Step>

  <Step title="Load the file">
    Add this line to `lua/leyland/core/init.lua` or `init.lua`:

    ```lua
    require("leyland.core.custom-keymaps")
    ```
  </Step>

  <Step title="Restart Neovim">
    Restart Neovim to load your custom keymaps.
  </Step>
</Steps>

## Common Keymap Patterns

### File Operations

```lua
local keymap = vim.keymap

-- Save file
keymap.set("n", "<leader>w", "<cmd>w<CR>", { desc = "Save file" })
keymap.set("n", "<leader>wa", "<cmd>wa<CR>", { desc = "Save all files" })

-- Quit
keymap.set("n", "<leader>q", "<cmd>q<CR>", { desc = "Quit" })
keymap.set("n", "<leader>qa", "<cmd>qa<CR>", { desc = "Quit all" })
keymap.set("n", "<leader>Q", "<cmd>q!<CR>", { desc = "Force quit" })

-- Save and quit
keymap.set("n", "<leader>wq", "<cmd>wq<CR>", { desc = "Save and quit" })
```

### Window Management

The current window keymaps in `lua/leyland/core/keymaps.lua:11-12`:

```lua
keymap.set("n", "<leader>|", "<C-w>v", { desc = "Split window vertically" })
keymap.set("n", "<leader>sh", "<C-w>s", { desc = "Split window horizontally" })
```

Expand with more window operations:

```lua
-- Window splits
keymap.set("n", "<leader>|", "<C-w>v", { desc = "Split window vertically" })
keymap.set("n", "<leader>-", "<C-w>s", { desc = "Split window horizontally" })
keymap.set("n", "<leader>se", "<C-w>=", { desc = "Make splits equal size" })
keymap.set("n", "<leader>sx", "<cmd>close<CR>", { desc = "Close current split" })

-- Window navigation
keymap.set("n", "<C-h>", "<C-w>h", { desc = "Move to left split" })
keymap.set("n", "<C-j>", "<C-w>j", { desc = "Move to below split" })
keymap.set("n", "<C-k>", "<C-w>k", { desc = "Move to above split" })
keymap.set("n", "<C-l>", "<C-w>l", { desc = "Move to right split" })

-- Window resizing
keymap.set("n", "<C-Up>", "<cmd>resize +2<CR>", { desc = "Increase window height" })
keymap.set("n", "<C-Down>", "<cmd>resize -2<CR>", { desc = "Decrease window height" })
keymap.set("n", "<C-Left>", "<cmd>vertical resize -2<CR>", { desc = "Decrease window width" })
keymap.set("n", "<C-Right>", "<cmd>vertical resize +2<CR>", { desc = "Increase window width" })
```

### Buffer Management

The current buffer keymaps in `lua/leyland/core/keymaps.lua:14-15`:

```lua
keymap.set("n", "<leader>bd", "<cmd>bd<CR>", { desc = "Close buffer" })
keymap.set("n", "<leader>ba", "<cmd>%bd<CR>", { desc = "Close all buffers" })
```

Expand with more buffer operations:

```lua
-- Buffer navigation
keymap.set("n", "<Tab>", "<cmd>bnext<CR>", { desc = "Next buffer" })
keymap.set("n", "<S-Tab>", "<cmd>bprevious<CR>", { desc = "Previous buffer" })
keymap.set("n", "<leader>bb", "<cmd>e #<CR>", { desc = "Switch to last buffer" })

-- Buffer management
keymap.set("n", "<leader>bd", "<cmd>bd<CR>", { desc = "Close buffer" })
keymap.set("n", "<leader>bD", "<cmd>bd!<CR>", { desc = "Force close buffer" })
keymap.set("n", "<leader>ba", "<cmd>%bd<CR>", { desc = "Close all buffers" })
keymap.set("n", "<leader>bo", "<cmd>%bd|e#|bd#<CR>", { desc = "Close other buffers" })
```

### Text Editing

```lua
-- Better indenting
keymap.set("v", "<", "<gv", { desc = "Indent left and reselect" })
keymap.set("v", ">", ">gv", { desc = "Indent right and reselect" })

-- Move lines up/down
keymap.set("n", "<A-j>", "<cmd>m .+1<CR>==", { desc = "Move line down" })
keymap.set("n", "<A-k>", "<cmd>m .-2<CR>==", { desc = "Move line up" })
keymap.set("v", "<A-j>", ":m '>+1<CR>gv=gv", { desc = "Move selection down" })
keymap.set("v", "<A-k>", ":m '<-2<CR>gv=gv", { desc = "Move selection up" })

-- Better paste
keymap.set("v", "p", '"_dP', { desc = "Paste without yanking" })

-- Delete without yanking
keymap.set({"n", "v"}, "<leader>d", '"_d', { desc = "Delete without yanking" })

-- Select all
keymap.set("n", "<C-a>", "ggVG", { desc = "Select all" })
```

### Search and Replace

```lua
-- Clear search highlights
keymap.set("n", "<Esc>", "<cmd>nohlsearch<CR>", { desc = "Clear search highlights" })

-- Keep search centered
keymap.set("n", "n", "nzzzv", { desc = "Next search result (centered)" })
keymap.set("n", "N", "Nzzzv", { desc = "Previous search result (centered)" })

-- Search and replace word under cursor
keymap.set("n", "<leader>sr", [[:%s/\<<C-r><C-w>\>/<C-r><C-w>/gI<Left><Left><Left>]], { desc = "Search and replace word" })
```

### Quick Exit from Insert Mode

The commented-out keymap in `lua/leyland/core/keymaps.lua:5`:

```lua
-- Uncomment to enable jk to exit insert mode
keymap.set("i", "jk", "<ESC>", { desc = "Exit Insert mode with jk" })
keymap.set("i", "kj", "<ESC>", { desc = "Exit Insert mode with kj" })
```

## Plugin-Specific Keymaps

Many plugins define their keymaps in their configuration. Here are examples:

### Telescope Keymaps

```lua
return {
  "nvim-telescope/telescope.nvim",
  keys = {
    { "<leader>ff", "<cmd>Telescope find_files<cr>", desc = "Find files" },
    { "<leader>fg", "<cmd>Telescope live_grep<cr>", desc = "Live grep" },
    { "<leader>fb", "<cmd>Telescope buffers<cr>", desc = "Find buffers" },
    { "<leader>fh", "<cmd>Telescope help_tags<cr>", desc = "Help tags" },
    { "<leader>fr", "<cmd>Telescope oldfiles<cr>", desc = "Recent files" },
    { "<leader>fc", "<cmd>Telescope commands<cr>", desc = "Commands" },
  },
}
```

### Neo-tree Keymaps

```lua
return {
  "nvim-neo-tree/neo-tree.nvim",
  keys = {
    { "<leader>e", "<cmd>Neotree toggle<cr>", desc = "Toggle file explorer" },
    { "<leader>o", "<cmd>Neotree focus<cr>", desc = "Focus file explorer" },
  },
}
```

### LSP Keymaps

LSP keymaps are typically set in the LSP configuration's `on_attach` function:

```lua
local on_attach = function(client, bufnr)
  local opts = { noremap = true, silent = true, buffer = bufnr }
  
  vim.keymap.set("n", "gd", vim.lsp.buf.definition, { desc = "Go to definition", buffer = bufnr })
  vim.keymap.set("n", "gr", vim.lsp.buf.references, { desc = "Show references", buffer = bufnr })
  vim.keymap.set("n", "K", vim.lsp.buf.hover, { desc = "Show hover info", buffer = bufnr })
  vim.keymap.set("n", "<leader>rn", vim.lsp.buf.rename, { desc = "Rename symbol", buffer = bufnr })
  vim.keymap.set("n", "<leader>ca", vim.lsp.buf.code_action, { desc = "Code action", buffer = bufnr })
end
```

## Advanced Keymap Techniques

### Keymap with Function

```lua
keymap.set("n", "<leader>rw", function()
  local word = vim.fn.expand("<cword>")
  vim.cmd(":%s/" .. word .. "//g")
  vim.api.nvim_feedkeys(vim.api.nvim_replace_termcodes("<Left><Left>", true, false, true), "n", false)
end, { desc = "Replace word under cursor" })
```

### Conditional Keymaps

```lua
-- Only set keymap if a plugin is available
local has_telescope, telescope = pcall(require, "telescope.builtin")
if has_telescope then
  keymap.set("n", "<leader>ff", telescope.find_files, { desc = "Find files" })
end
```

### Buffer-Local Keymaps

```lua
-- Set keymap only for the current buffer
vim.api.nvim_create_autocmd("FileType", {
  pattern = "markdown",
  callback = function()
    vim.keymap.set("n", "<leader>mp", "<cmd>MarkdownPreview<CR>", {
      desc = "Preview markdown",
      buffer = true, -- Only applies to current buffer
    })
  end,
})
```

### Leader Key Timeout

Configure how long Neovim waits for the next key after pressing leader:

```lua
vim.opt.timeoutlen = 300 -- Wait 300ms for next key (default is 1000)
```

## Keymap Options Reference

| Option | Type | Description | Default |
|--------|------|-------------|----------|
| `desc` | string | Description (shown in which-key) | `nil` |
| `silent` | boolean | Don't show command in command line | `false` |
| `noremap` | boolean | Don't allow recursive mapping | `true` |
| `expr` | boolean | Evaluate rhs as expression | `false` |
| `buffer` | number/boolean | Buffer-local keymap | `nil` |
| `nowait` | boolean | Don't wait for more keys | `false` |
| `remap` | boolean | Allow recursive mapping | `false` |

<Note>
`vim.keymap.set()` sets `noremap = true` by default, unlike the older `vim.api.nvim_set_keymap()` function.
</Note>

## Viewing Current Keymaps

### Using Built-in Commands

```vim
:map          " Show all keymaps
:nmap         " Show normal mode keymaps
:imap         " Show insert mode keymaps
:vmap         " Show visual mode keymaps
:map <leader> " Show all leader keymaps
```

### Using Telescope

If you have Telescope installed:

```vim
:Telescope keymaps
```

### Using which-key

If you have which-key installed, press `<leader>` and wait - it will show all available keymaps.

## Best Practices

1. **Use Descriptive Names**: Always include a `desc` option for documentation
   ```lua
   -- Good
   keymap.set("n", "<leader>w", "<cmd>w<CR>", { desc = "Save file" })
   
   -- Bad
   keymap.set("n", "<leader>w", "<cmd>w<CR>")
   ```

2. **Organize by Category**: Group related keymaps together with comments
   ```lua
   -- File operations
   keymap.set("n", "<leader>w", "<cmd>w<CR>", { desc = "Save file" })
   keymap.set("n", "<leader>q", "<cmd>q<CR>", { desc = "Quit" })
   
   -- Window management
   keymap.set("n", "<leader>|", "<C-w>v", { desc = "Split vertically" })
   ```

3. **Use Consistent Patterns**: Follow a logical naming scheme for leader keymaps
   - `<leader>f` - Find/File operations
   - `<leader>b` - Buffer operations
   - `<leader>w` - Window operations
   - `<leader>g` - Git operations
   - `<leader>l` - LSP operations

4. **Don't Override Important Defaults**: Avoid remapping essential Vim keys like `hjkl`, `u`, `Ctrl-r`, etc.

5. **Test Before Committing**: Test new keymaps thoroughly before adding them permanently

## Troubleshooting

### Keymap Not Working

1. Check if another keymap is overriding it:
   ```vim
   :verbose map <your-key>
   ```
2. Verify the mode is correct ("n" for normal, "i" for insert, etc.)
3. Ensure the file is being sourced (add a print statement to test)

### Keymap Conflicts

If two plugins define the same keymap:

```lua
-- Disable plugin's default keymap
vim.g.plugin_no_default_keymaps = 1

-- Then define your own
keymap.set("n", "<leader>x", function() require('plugin').action() end, { desc = "Custom action" })
```

### Leader Key Not Working

Ensure the leader key is set before defining keymaps:

```lua
vim.g.mapleader = " "  -- Must be set before lazy.nvim loads plugins
vim.g.maplocalleader = "\\"
```

## Example: Complete Custom Keymaps File

Here's a comprehensive example of a custom keymaps file:

```lua
-- lua/leyland/core/custom-keymaps.lua
local keymap = vim.keymap

-- ═══════════════════════════════════════════════════════════
-- File Operations
-- ═══════════════════════════════════════════════════════════
keymap.set("n", "<leader>w", "<cmd>w<CR>", { desc = "Save file" })
keymap.set("n", "<leader>wa", "<cmd>wa<CR>", { desc = "Save all files" })
keymap.set("n", "<leader>q", "<cmd>q<CR>", { desc = "Quit" })
keymap.set("n", "<leader>qa", "<cmd>qa<CR>", { desc = "Quit all" })

-- ═══════════════════════════════════════════════════════════
-- Better Navigation
-- ═══════════════════════════════════════════════════════════
keymap.set("n", "<C-d>", "<C-d>zz", { desc = "Scroll down and center" })
keymap.set("n", "<C-u>", "<C-u>zz", { desc = "Scroll up and center" })
keymap.set("n", "n", "nzzzv", { desc = "Next search (centered)" })
keymap.set("n", "N", "Nzzzv", { desc = "Prev search (centered)" })

-- ═══════════════════════════════════════════════════════════
-- Window Management
-- ═══════════════════════════════════════════════════════════
keymap.set("n", "<C-h>", "<C-w>h", { desc = "Move to left split" })
keymap.set("n", "<C-j>", "<C-w>j", { desc = "Move to below split" })
keymap.set("n", "<C-k>", "<C-w>k", { desc = "Move to above split" })
keymap.set("n", "<C-l>", "<C-w>l", { desc = "Move to right split" })

-- ═══════════════════════════════════════════════════════════
-- Better Editing
-- ═══════════════════════════════════════════════════════════
keymap.set("v", "<", "<gv", { desc = "Indent left" })
keymap.set("v", ">", ">gv", { desc = "Indent right" })
keymap.set("v", "p", '"_dP', { desc = "Paste without yanking" })
keymap.set({"n", "v"}, "<leader>d", '"_d', { desc = "Delete without yanking" })

-- ═══════════════════════════════════════════════════════════
-- Quick Exit Insert Mode
-- ═══════════════════════════════════════════════════════════
keymap.set("i", "jk", "<ESC>", { desc = "Exit insert mode" })
```

## Next Steps

- [Adding Plugins](/customization/adding-plugins) - Learn how to add new plugins
- [Changing Colorschemes](/customization/changing-colorschemes) - Customize your editor's appearance
